const menuToggle = document.querySelector('.navbar-toggler');
const navBarMenu = document.querySelector('.navbar__wrapper');
menuToggle.addEventListener('click', () => {
  if (navBarMenu.classList.contains('navbar__wrapper--hidden')) {
    navBarMenu.classList.remove('navbar__wrapper--hidden')
  } else {
    navBarMenu.classList.add('navbar__wrapper--hidden')
  };
  if (menuToggle.classList.contains('navbar-toggler--opened')) {
    menuToggle.classList.remove('navbar-toggler--opened')
    menuToggle.classList.add('navbar-toggler--closed')
  } else {
    menuToggle.classList.remove('navbar-toggler--closed');
    menuToggle.classList.add('navbar-toggler--opened');
  }
});


$(document).ready(function() {
  $('.progress__slider').slick({
    arrows: true,
    dots: false,
    speed: 1000,
    autoplay: true,
    autoplaySpeed: 1500,
    responsive: [{
        breakpoint: 767,
        settings: {
          slidesToShow: 4
        }
      },
      {
        breakpoint: 320,
        settings: {
          slidesToShow: 1,
          variableWidth: true
        }
      },
    ],
    mobileFirst: true
  });
});
const scrollTo = (element) => {
  window.scroll({
    left: 0,
    top: element.offsetTop,
    behavior: 'smooth'
  })
}

const burger = () => {
  navBarMenu.classList.add('navbar__wrapper--hidden');
  menuToggle.classList.remove('navbar-toggler--closed');
  menuToggle.classList.add('navbar-toggler--opened');
}

const about = document.querySelector('.list__item-link--first');
const servic = document.querySelector('.list__item-link--servise');
const contact = document.querySelector('.list__item-link--contact');
const howIs = document.querySelector('.about-us');
const info = document.querySelector('.services');
const footer = document.querySelector('.contact');

about.addEventListener('click', (evt) => {
  evt.preventDefault();
  scrollTo(howIs);
  burger();
})

servic.addEventListener('click', (evt) => {
  evt.preventDefault();
  scrollTo(info);
  burger();
})

contact.addEventListener('click', (evt) => {
  evt.preventDefault();
  scrollTo(footer);
  burger();
})


const popupBg = document.querySelector('.form__calculat');
const popup = document.querySelector('.form__calculat-position');
const knopka = document.querySelector('.form__button');
const close = document.querySelector('.form__calculat-close');

function start() {
  const clean = document.getElementById('clean').value;
  switch (clean) {
    case "Поддерживающая":
      cena = 80;
      break
    case "Генеральная":
      cena = 120;
      break
    case "После ремонта":
      cena = 170;
      break
    case "После аренды":
      cena = 120;
      break
  }
  const info = document.getElementById('info').value;
  const name = document.getElementById('name').value;
  if (info == "") {
    alert("Вы не указали количество м²");
  } else if (name == "") {
    alert("Вы не указали количество комнат");
  } else {
    area = parseFloat(info) * parseFloat(name);
    document.querySelector('.form__calculat-area').innerHTML = "Площадь = " + area + " кв. м.";
    price = area * cena;
    document.querySelector('.form__calculat-price').innerHTML = "Стоимость = " + price + " р.";
    popupBg.classList.add('active-one');
    popup.classList.add('active');
  }
};

knopka.addEventListener('click', start);

close.addEventListener('click', () => {
  popupBg.classList.remove('active-one');
  popup.classList.remove('active');
})

document.addEventListener('click', (e) => {
  if (e.target === popupBg) {
    popupBg.classList.remove('active-one');
    popup.classList.remove('active');
  }
});

const wrapper = document.querySelector('.wrapper');
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('form-popup');
  form.addEventListener('submit', formSend);
  async function formSend(e) {
    e.preventDefault();
    let error = formValidate(form);
    let formData = new FormData(form);
    if (error === 0) {
      let response = await fetch('sendform.php', {
        method: 'POST',
        body: formData
      });
      if (response.ok) {
        swal({
          title: "Спасибо за заявку!",
          type: "success",
          showConfirmButton: false,
          timer: 2000
        })
        form.reset();
        wrapper.classList.remove("wrapper--show");
      } else {
        alert('Ошибка')
      }
    } else {
      alert('Заполните обязательные поля')
    }
  }

  const formValidate = (form) => {
    let error = 0;
    let formReq = document.querySelectorAll('._req');
    for (let index = 0; index < formReq.length; index++) {
      const input = formReq[index];
      formRemoveError(input);
      if (input.classList.contains('_phone')) {
        if (phoneTest(input)) {
          formAddError(input);
          error++;
        }
      } else if (input.getAttribute('type') === 'checkbox' && input.checked === false) {
        formAddError(input);
        error++;
      } else {
        if (input.value === '') {
          formAddError(input);
          error++;
        }
      }
    }
    return error;
  }


  const formAddError = (input) => {
    input.parentElement.classList.add('_error');
    input.classList.add('_error');
  }

  const formRemoveError = (input) => {
    input.parentElement.classList.remove('_error');
    input.classList.remove('_error');
  }


  const phoneTest = (input) => {
    return !/(\+7|8)[- _]*\(?[- _]*(\d{3}[- _]*\)?([- _]*\d){7}|\d\d[- _]*\d\d[- _]*\)?([- _]*\d){6})/.test(input.value);
  }
});

document.addEventListener('click', function strape(e) {
  if (e.target === wrapper) {
    wrapper.classList.remove('wrapper--show');
  }
});

const more = document.querySelector('.main__more');
more.addEventListener('click', function() {
  wrapper.classList.add('wrapper--show');
});

const request = document.querySelector('.request');
request.addEventListener('click', function() {
  wrapper.classList.add('wrapper--show');
})

const checkCookies = () => {
  let cookieDate = localStorage.getItem('cookieDate');
  let cookieNotification = document.getElementById('cookie_notification');
  let cookieBtn = cookieNotification.querySelector('.cookie_accept');

  if (!cookieDate || (+cookieDate + 31536000000) < Date.now()) {
    cookieNotification.classList.add('show');
  }

  cookieBtn.addEventListener('click', function() {
    localStorage.setItem('cookieDate', Date.now());
    cookieNotification.classList.remove('show');
  })
}
checkCookies();